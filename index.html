<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Babesugab Robot Maze</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Blockly + Interpreter -->
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/acorn@8/dist/acorn.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/NeilFraser/JS-Interpreter@master/interpreter.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <link rel="icon" type="image/png" sizes="32x32" href="icon-192.png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json" />

  <!-- Vercel Web Analytics -->
  <script>
    window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>
</head>

<body class="bg-gradient-to-br from-blue-100 to-purple-100 min-h-screen flex flex-col">

  <div class="flex flex-col lg:flex-row flex-grow h-full">

    <!-- LEFT / GAME -->
    <section id="gameArea" class="w-full lg:w-1/2 flex flex-col items-center justify-center gap-4 p-4 max-w-screen-lg mx-auto lg:mx-0">

      <header class="flex items-center gap-4 w-full max-w-xl px-2">
        <img id="playerAvatarHeader" src="icon-192.png"
          class="w-14 h-14 rounded-full border-4 border-yellow-400 object-cover shrink-0" alt="Avatar Pemain" />
        <div>
          <h1 class="text-2xl font-bold text-purple-700 leading-tight">
            ğŸ¤– Robot Maze Game
          </h1>
          <p id="playerNameHeader" class="text-xs text-gray-600 mt-1">Player</p>
        </div>
      </header>

      <main class="relative bg-white p-4 rounded-xl shadow-lg w-full max-w-xl">
        <canvas id="canvas" class="w-full h-auto max-h-[400px] rounded-md" width="400" height="400" aria-label="Game Canvas"></canvas>
      </main>

      <!-- GAME NOTIFICATION -->
      <div id="gameToast" class="hidden fixed pointer-events-none z-50 inset-x-4 top-8 max-w-xl mx-auto">
        <div id="gameToastBox"
          class="rounded-lg shadow-xl p-4 text-sm border-l-4 bg-blue-50 border-blue-500 animate-slide">
          <h2 id="gameToastTitle" class="font-bold"></h2>
          <p id="gameToastBody" class="text-gray-600 mt-1"></p>
        </div>
      </div>

      <div class="text-lg font-semibold w-full max-w-xl px-2 flex justify-center gap-4">
        <span>â­ Score: <span id="score">0</span></span>
        <span>ğŸ Level: <span id="level">1</span></span>
      </div>

      <nav
        class="flex flex-wrap justify-center gap-2 bg-white p-3 rounded-xl shadow w-full max-w-xl px-2 text-center">

        <button class="btn-primary min-w-[80px]" onclick="run()" aria-label="Jalankan Game">â–¶ Run</button>
        <button id="resetBtn" onclick="resetGame()" class="btn-secondary hidden min-w-[80px]"
          aria-label="Reset Game">ğŸ”„ Reset</button>
        <button class="btn-secondary min-w-[80px]" onclick="pause()" aria-label="Pause Game">â¸ Pause</button>
        <button class="btn-secondary min-w-[80px]" onclick="stepOnce()" aria-label="Step Game">â­ Step</button>

        <div class="flex items-center gap-1 min-w-[130px] justify-center px-2">
          <span role="img" aria-label="Kura-kura">ğŸ¢</span>
          <input id="speed" type="range" min="1" max="20" value="5" class="w-full cursor-pointer" aria-label="Kontrol kecepatan" />
          <span role="img" aria-label="Kelinci">ğŸ‡</span>
        </div>

      </nav>
    </section>

    <!-- RIGHT / BLOCKLY -->
    <aside
      class="w-full lg:w-1/2 bg-white rounded-t-3xl lg:rounded-l-3xl shadow-inner overflow-auto h-[40vh] lg:h-auto max-w-screen-lg mx-auto lg:mx-0 px-4 py-2">

      <div id="blocklyDiv" class="w-full h-full min-h-[400px] lg:min-h-[600px]"></div>

    </aside>

  </div>

  <!-- TOOLBOX -->
  <xml id="toolbox" style="display:none">
    <block type="start"></block>
    <block type="move_forward"></block>
    <block type="turn_left"></block>
    <block type="turn_right"></block>
    <block type="controls_repeat_ext">
      <value name="TIMES">
        <shadow type="math_number">
          <field name="NUM">4</field>
        </shadow>
      </value>
    </block>
  </xml>

  <!-- PLAYER SETUP MODAL -->
  <div id="playerModal"
    class="fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4 hidden overflow-auto">

    <div
      class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md animate-scale max-h-[90vh] overflow-auto flex flex-col items-center gap-4">

      <h2 class="text-lg font-bold mb-2 text-center">ğŸ‘¤ Player Setup</h2>

      <img id="avatarModalPreview" src="icon-192.png"
        class="w-24 h-24 rounded-full border-4 border-yellow-400 object-cover" alt="Preview Avatar" />

      <input type="file" id="avatarModalUpload" accept="image/*"
        class="text-xs w-full border border-gray-300 rounded px-3 py-2 cursor-pointer" aria-label="Unggah avatar" />

      <input id="playerModalName" placeholder="Nama pemain"
        class="border rounded px-3 py-2 w-full text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
        aria-label="Nama pemain" />

      <button onclick="startGame()"
        class="mt-2 bg-purple-600 text-white rounded-lg px-6 py-2 text-sm hover:bg-purple-700 w-full">
        â–¶ Mulai Game
      </button>

    </div>
  </div>

  <script src="script.js?v=1"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>

</body>

</html>

