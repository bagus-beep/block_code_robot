<body class="bg-gradient-to-br from-blue-100 to-purple-100 min-h-screen">

<div class="flex flex-col lg:flex-row min-h-screen">

  <!-- ================= GAME PANEL ================= -->
  <div class="lg:w-1/2 w-full flex flex-col items-center justify-start gap-4 p-4">

    <!-- HEADER -->
    <div class="flex items-center gap-4">
      <img id="playerAvatarHeader"
           src="icon-192.png"
           class="w-12 h-12 rounded-full border-4 border-yellow-400 object-cover"/>

      <div>
        <h1 class="text-xl sm:text-2xl font-bold text-purple-700">
          ğŸ¤– Robot Maze Game
        </h1>
        <p id="playerNameHeader" class="text-xs text-gray-500">
          Player
        </p>
      </div>
    </div>

    <!-- GAME AREA -->
    <div id="gameArea"
         class="relative bg-white p-3 rounded-2xl shadow-lg w-full max-w-[420px]">
      <canvas id="canvas" width="400" height="400"
              class="mx-auto block"></canvas>
    </div>

    <!-- TOAST -->
    <div id="gameToast"
         class="hidden fixed pointer-events-none z-[2147483647]">
      <div id="gameToastBox"
           class="rounded-lg shadow-xl p-4 text-sm border-l-4 animate-slide">
        <h2 id="gameToastTitle" class="font-bold"></h2>
        <p id="gameToastBody" class="text-gray-600 mt-1"></p>
      </div>
    </div>

    <!-- SCORE -->
    <div class="text-base sm:text-lg font-semibold bg-white px-4 py-2 rounded-xl shadow">
      â­ Score: <span id="score">0</span>
      <span class="mx-1">|</span>
      ğŸ Level: <span id="level">1</span>
    </div>

    <!-- CONTROLS -->
    <div class="flex flex-wrap items-center justify-center gap-2 bg-white p-3 rounded-xl shadow w-full max-w-[520px]">

      <button class="btn-primary" onclick="run()">â–¶ Run</button>

      <button id="resetBtn"
              onclick="resetGame()"
              class="btn-secondary hidden">
        ğŸ”„ Reset
      </button>

      <button class="btn-secondary" onclick="pause()">â¸ Pause</button>
      <button class="btn-secondary" onclick="stepOnce()">â­ Step</button>

      <div class="flex items-center gap-1">
        ğŸ¢
        <input id="speed" type="range" min="1" max="20" value="5">
        ğŸ‡
      </div>
    </div>
  </div>

  <!-- ================= BLOCKLY PANEL ================= -->
  <div class="lg:w-1/2 w-full flex-1 bg-white lg:rounded-l-3xl shadow-inner overflow-hidden">
    <div id="blocklyDiv" class="w-full h-[60vh] lg:h-full"></div>
  </div>

</div>

<!-- ================= TOOLBOX ================= -->
<xml id="toolbox" style="display:none">
  <block type="start"></block>
  <block type="move_forward"></block>
  <block type="turn_left"></block>
  <block type="turn_right"></block>
  <block type="controls_repeat_ext">
    <value name="TIMES">
      <shadow type="math_number">
        <field name="NUM">4</field>
      </shadow>
    </value>
  </block>
</xml>

<!-- ================= PLAYER MODAL ================= -->
<div id="playerModal"
     class="fixed inset-0 bg-black/50 flex items-center justify-center z-[9999] hidden">

  <div class="bg-white rounded-2xl shadow-xl p-6 w-80 animate-scale">
    <h2 class="text-lg font-bold mb-3 text-center">
      ğŸ‘¤ Player Setup
    </h2>

    <div class="flex flex-col items-center gap-3">
      <img id="avatarModalPreview"
           src="icon-192.png"
           class="w-24 h-24 rounded-full border-4 border-yellow-400 object-cover"/>

      <input type="file"
             id="avatarModalUpload"
             accept="image/*"
             class="text-xs"/>

      <input id="playerModalName"
             placeholder="Nama pemain"
             class="border rounded px-3 py-2 w-full text-sm"/>

      <button onclick="startGame()"
              class="mt-2 bg-purple-600 text-white rounded-lg px-4 py-2 text-sm hover:bg-purple-700">
        â–¶ Mulai Game
      </button>
    </div>
  </div>
</div>

<script src="script.js?v=1"></script>
<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
